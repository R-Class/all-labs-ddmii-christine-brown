---
title: "Lab 5 DDMII"
author: "Christine Brown"
date: "February 22, 2017"
output: github_document
---

``````{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,  warning = F , message = F)
```

```{r}
setwd("C:/Users/brown/Documents/Grad School/Fall 16/DDMII/lab5")
library( censusapi )
library( dplyr )
library( ggmap )
library( jsonlite )
library( maptools )
library( memisc )
library( RCurl )
library( sp )

censuskey <- "5a1a01fa6496e71097aa2d4a066bed72117c8069"
```


Create a "research database" of home values in Syracuse
1. Start with the dataset of home prices and assets collected from Zillow
2. Add a census tracts FIPS ID to each home (spatial join to census tracts)
3. Add census data to each home
4. Aggregate crimes by census tract (spatial join) and add to the dataset

Get Data
```{r}
#Get Data
home.val <- read.csv("https://raw.githubusercontent.com/lecy/hedonic-prices/master/Data/Housing%20Price%20In-Class%20Exercise%20(Responses).csv", stringsAsFactors=FALSE)

#rename columns
names( home.val ) <- c("timestamp","price","X1","X2","sqft","your.name","lot.size","beds","bath",
                       "garage","year","elementary","middle","high","walk","tax","highway","restaurant",
                       "starbucks","park","mall","address","zip","tract" )

#remove commas from numbers and cast as numeric
home.val$price <- as.numeric( gsub( ",","", home.val$price ) )
home.val$sqft <- as.numeric( gsub( ",","", home.val$sqft ) )
home.val$lot.size <- as.numeric( gsub( ",","", home.val$lot.size ) )
home.val$tax <- as.numeric( gsub( ",","", home.val$tax ) )

#replace NA lot sizes with average lot size
home.val$lot.size[ is.na( home.val$lot.size ) ] <- mean( home.val$lot.size, na.rm=T )

#prepare for geocoding

##make addresses street addresses only
home.val$address <- gsub(", Syracuse, NY 13205", "", home.val$address)
home.val$address <- gsub(", Syracuse, NY 13206", "", home.val$address)
home.val$address <- gsub(", Syracuse, NY 13208", "", home.val$address)
home.val$address <- gsub(", Syracuse, NY 13210", "", home.val$address)
home.val$address <- gsub(", Syracuse, NY", "", home.val$address)
home.val$address <- gsub(" Syracuse, NY", "", home.val$address)
home.val$address <- gsub(",", " ", home.val$address)


##create a full address vector
home.val <- mutate(home.val, full_address=paste(address,", Syracuse, NY"))

#geocode
coordinates <- suppressMessages(geocode( home.val$full_address, messaging=F ))

#add geocode information to dataframe
home.val2 <- cbind(home.val, coordinates)

#get census tract information
syr <- readShapePoly( fn="tl_2010_36067_tract10", proj4string=CRS("+proj=longlat +datum=WGS84") )

#join census tract inforamtion with homes
coordinates_SP <- SpatialPoints(coordinates, proj4string=CRS("+proj=longlat +datum=WGS84") )
poly.matched <- over(coordinates_SP, syr )
houses.data <- cbind( home.val2, poly.matched )

```

